<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Luck Spin</title>
<style>
  body { margin:0; font-family:Arial,sans-serif; background:#222; text-align:center; color:#fff; }
  .wheel-container { position:relative; margin:100px auto; width:320px; height:320px; }
  canvas { border-radius:50%; }
  .pointer { position:absolute; top:-30px; left:50%; transform:translateX(-50%); width:0; height:0; }
  .pointer::before {
    content:""; position:absolute; left:50%; transform:translateX(-50%);
    border-left:20px solid transparent; border-right:20px solid transparent; border-top:30px solid red;
  }
  button { margin-top:20px; padding:10px 20px; font-size:18px; cursor:pointer; }
  #popup { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); justify-content:center; align-items:center; }
  #popup .popup-content { background:#333; padding:20px; border-radius:12px; }
</style>
</head>
<body>

<div class="wheel-container">
  <div class="pointer"></div>
  <canvas id="wheel" width="320" height="320"></canvas>
</div>
<button id="spinBtn">SPIN</button>

<div id="popup">
  <div class="popup-content">
    <p id="popupText"></p>
    <button onclick="closePopup()">Tutup</button>
  </div>
</div>

<script>
const wheelCanvas = document.getElementById("wheel");
const ctx = wheelCanvas.getContext("2d");
const size = wheelCanvas.width;
const slices = ["X20","X50","X100","X250","X500","X1000"];
const colors = ["#ff4d4d","#4da6ff","#4dff88","#ffcc00","#ff66cc","#66ffcc"];
const sliceDeg = 360 / slices.length;
let deg = 0, isSpinning = false;

function drawWheel() {
  ctx.clearRect(0,0,size,size);
  for(let i=0;i<slices.length;i++){
    ctx.beginPath();
    ctx.moveTo(size/2,size/2);
    ctx.arc(size/2,size/2,size/2,(sliceDeg*i)*Math.PI/180,(sliceDeg*(i+1))*Math.PI/180);
    ctx.fillStyle=colors[i]; ctx.fill();
    ctx.strokeStyle="#000"; ctx.lineWidth=2; ctx.stroke();
    ctx.save();
    ctx.translate(size/2,size/2);
    ctx.rotate((sliceDeg*(i+0.5))*Math.PI/180);
    ctx.textAlign="right"; ctx.fillStyle="#000"; ctx.font="bold 16px Arial";
    ctx.fillText(slices[i],size/2-10,10);
    ctx.restore();
  }
}
drawWheel();

function spin() {
  if(isSpinning) return;
  isSpinning=true;
  const spins = 5 + Math.random()*5; // jumlah putaran
  const finalDeg = deg + spins*360 + Math.random()*360; // target akhir

  const duration = 5000; // 5 detik
  const start = performance.now();
  const initialDeg = deg;

  function animate(time){
    let elapsed = time-start;
    if(elapsed>duration) elapsed=duration;
    const progress = elapsed/duration;
    // ease out cubic
    const ease = 1 - Math.pow(1-progress,3);
    const currentDeg = initialDeg + (finalDeg-initialDeg)*ease;
    wheelCanvas.style.transform = `rotate(${currentDeg}deg)`;
    if(elapsed<duration){
      requestAnimationFrame(animate);
    } else {
      deg = finalDeg % 360;
      isSpinning=false;
      showResult();
    }
  }
  requestAnimationFrame(animate);
}

function showResult(){
  const pointerAngle=(270-deg+360)%360;
  const winningIndex=Math.floor(pointerAngle/sliceDeg)%slices.length;
  const result=slices[winningIndex];
  document.getElementById("popupText").innerText = `ðŸŽ‰ Kamu dapat ${result} ðŸŽ‰`;
  document.getElementById("popup").style.display="flex";
}

function closePopup(){
  document.getElementById("popup").style.display="none";
}

document.getElementById("spinBtn").addEventListener("click", spin);
</script>

</body>
</html>
